name: Auto Update All Mangas
on:
    # Run every 3 hours
    schedule:
        - cron: "0 */3 * * *"
    
    # Allow manual trigger
    workflow_dispatch:
        inputs:
            force_update:
                description: "Force update all chapters (ignore existing)"
                required: false
                type: boolean
                default: false

jobs:
    update-mangas:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
            
            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                  python-version: "3.11"
            
            - name: Install dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install requests beautifulsoup4 supabase
            
            - name: Run auto updater
              env:
                  SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
                  SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
                  FORCE_UPDATE: ${{ github.event.inputs.force_update || 'false' }}
              run: |
                  python auto_updater.py
            
            - name: Upload update logs
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: update-logs-${{ github.run_number }}
                  path: |
                      update_*.log
                      auto_updater.log
                  retention-days: 30
              continue-on-error: true
